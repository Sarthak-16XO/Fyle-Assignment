<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Repositories</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- Custom CSS -->
  <style>
    body {
      background-color: #f8f9fa;
    }

    .container {
      margin-top: 50px;
    }

    .profile-section {
      text-align: center;
      margin-bottom: 30px;
    }

    .profile-image {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      margin-bottom: 10px;
    }

    .repo-card {
      margin-bottom: 20px;
    }

    .pagination {
      justify-content: center;
    }

    .page-link {
      cursor: pointer;
    }

    #repoSearchDiv {
      display: none;
      margin-bottom: 20px;
      /* Add margin to give space between the input div and repositoriesList */
      position: relative;
      /* Set position to relative for absolute positioning */
    }

    #repoSearchInput {
      width: 80%;
      /* Add your desired width here */
    }

    #repoSearchInput+.input-group-append {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <h2 class="text-center mb-4">GitHub Repositories</h2>
        <div class="input-group mb-3">
          <input type="text" id="usernameInput" class="form-control" placeholder="Enter GitHub Username">
          <div class="input-group-append">
            <button class="btn btn-primary" onclick="getProfileAndRepositories()">Search</button>
          </div>
        </div>

        <div id="profileSection" class="profile-section"></div>

        <div id="repoSearchDiv" class="input-group mb-3" style="display: none;">
          <input type="text" id="repoSearchInput" class="form-control" placeholder="Search Repositories by Name">
          <div class="input-group-append">
            <button class="btn btn-primary" onclick="searchRepositories()">Search Repos</button>
          </div>
        </div>

        <div id="repositoriesList" class="row"></div>
        <nav aria-label="Page navigation">
          <ul class="pagination" id="pagination"></ul>
        </nav>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <script>
    const itemsPerPage = 10;
    let currentPage = 1;
    let allRepositories = [];

    function getProfileAndRepositories() {
      const username = document.getElementById('usernameInput').value;
      const apiUrl = `https://api.github.com/users/${username}`;
      const repositoriesApiUrl = `https://api.github.com/users/${username}/repos`;

      // Show loader while API calls are in progress
      showLoader();

      // Fetch user profile
      fetch(apiUrl)
        .then(response => response.json())
        .then(user => {
          displayUserProfile(user);

          // Show the repository search input when user is found
          document.getElementById('repoSearchDiv').style.display = 'block';
        })
        .catch(error => {
          console.error('Error fetching user profile:', error);
          alert('Error fetching user profile. Please try again.');
        })
        .finally(() => {
          // Hide loader when API calls are complete
          hideLoader();
        });

      // Fetch all repositories
      fetch(repositoriesApiUrl)
        .then(response => response.json())
        .then(repositories => {
          allRepositories = repositories;
          displayRepositories(allRepositories);
          displayPagination(allRepositories);
        })
        .catch(error => {
          console.error('Error fetching repositories:', error);
          alert('Error fetching repositories. Please try again.');
        });
    }

    function showLoader() {
      document.getElementById('repositoriesList').innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div></div>';
    }

    function hideLoader() {
      document.getElementById('repositoriesList').innerHTML = '';
    }

    function displayUserProfile(user) {
      const profileSection = document.getElementById('profileSection');
      profileSection.innerHTML = '';

      const profileContent = `
      <div style="display: flex; flex-direction: row; align-items: center;">
          <div>
              <img src="${user.avatar_url}" alt="Profile Image" class="profile-image">
          </div>
          <div style="margin-left: 20px; text-align: left">
              <h3>${user.name || user.login}</h3>
              <p>${user.login}</p>
              <p>${user.bio || 'No bio available'}</p>
              <p><a href="${user.html_url}" target="_blank">View on GitHub</a></p>
          </div>
      </div>
    `;

      profileSection.innerHTML = profileContent;
    }

    function searchRepositories() {
      const repoSearchInput = document.getElementById('repoSearchInput').value.trim().toLowerCase();

      // If the repoSearchInput is empty, display all repositories without filtering
      if (repoSearchInput === '') {
        displayRepositories(allRepositories);
        displayPagination(allRepositories);
      } else {
        // Filter repositories based on the repoSearchInput
        const filteredRepositories = allRepositories.filter(repo =>
          repo.name.toLowerCase().includes(repoSearchInput)
        );

        // Display filtered repositories and reset current page to 1
        currentPage = 1;
        displayRepositories(filteredRepositories);
        displayPagination(filteredRepositories);
      }
    }


    function displayRepositories(repositories) {
      const repositoriesList = document.getElementById('repositoriesList');
      repositoriesList.innerHTML = '';

      const repoSearchInput = document.getElementById('repoSearchInput').value.trim().toLowerCase();

      // Filter repositories based on the repoSearchInput if it's not empty
      const filteredRepositories = repoSearchInput === ' '
        ? repositories
        : repositories.filter(repo => repo.name.toLowerCase().includes(repoSearchInput));

      if (filteredRepositories.length === 0) {
        repositoriesList.innerHTML = '<p class="text-muted">No matching repositories found.</p>';
        return;
      }

      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const displayedRepos = filteredRepositories.slice(startIndex, endIndex);

      displayedRepos.forEach(repo => {
        const repoCard = document.createElement('div');
        repoCard.className = 'col-md-6 repo-card';

        const cardContent = `
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">${repo.name}</h5>
          <p class="card-text">${repo.description || 'No description available'}</p>
          <div class="">
            <li class="list-group-item">Stars: ${repo.stargazers_count}</li>
            <li class="list-group-item">Forks: ${repo.forks_count}</li>
            <p class="btn btn-primary">${repo.language || 'Not specified'}</p>
          </div>
          <a href="${repo.html_url}" class="btn btn-primary" target="_blank">View on GitHub</a>
        </div>
      </div>
    `;

        repoCard.innerHTML = cardContent;
        repositoriesList.appendChild(repoCard);
      });

      // Check if there are more pages and update the pagination
      if (filteredRepositories.length > itemsPerPage) {
        displayPagination(filteredRepositories);
      }
    }
    // Add an event listener for the Enter key on the username input
    document.getElementById('usernameInput').addEventListener('keyup', function (event) {
      if (event.key === 'Enter') {
        getProfileAndRepositories();
      }
    });

    // Add an event listener for the Enter key on the repo search input
    document.getElementById('repoSearchInput').addEventListener('keyup', function (event) {
      if (event.key === 'Enter') {
        searchRepositories();
      }
    });

    function displayPagination(repositories) {
      const totalPages = Math.ceil(repositories.length / itemsPerPage);
      const paginationList = document.getElementById('pagination');
      paginationList.innerHTML = '';

      const prevPageItem = document.createElement('li');
      prevPageItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
      const prevPageLink = document.createElement('a');
      prevPageLink.className = 'page-link';
      prevPageLink.innerText = 'Previous';
      prevPageLink.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          displayRepositories(allRepositories);
          displayPagination(allRepositories);
        }
      });
      prevPageItem.appendChild(prevPageLink);
      paginationList.appendChild(prevPageItem);

      for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement('li');
        pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
        const pageLink = document.createElement('a');
        pageLink.className = 'page-link';
        pageLink.innerText = i;
        pageLink.addEventListener('click', () => {
          currentPage = i;
          displayRepositories(allRepositories);
          displayPagination(allRepositories);
        });
        pageItem.appendChild(pageLink);
        paginationList.appendChild(pageItem);
      }

      const nextPageItem = document.createElement('li');
      nextPageItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
      const nextPageLink = document.createElement('a');
      nextPageLink.className = 'page-link';
      nextPageLink.innerText = 'Next';
      nextPageLink.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          displayRepositories(allRepositories);
          displayPagination(allRepositories);
        }
      });
      nextPageItem.appendChild(nextPageLink);
      paginationList.appendChild(nextPageItem);
    }
  </script>

</body>

</html>